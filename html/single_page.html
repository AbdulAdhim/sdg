<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The SDG Game</title>

    <!-- CSS & Bootstrap -->
    <link rel="stylesheet" href="../css/style_spage.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/style_wlc.css">

    <!-- Angular & JS-->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <script src="../js/invest.js" type='text/javascript'></script>

    <!-- Socket.io-->
    <script src="http://localhost:3000/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script>
        const token = 'fakeAuthToken-sendLoginRequestToGet';
        var socket = io(
            'http://localhost:3000', {
                query: {
                    token
                }
            }
        );
    </script>
    <script src="../js/create_join_ready.js" type='text/javascript'></script>
    <script src="../js/player_stat.js" type='text/javascript'></script>
</head>

<body id="bodyclick">
    <script>
        socket.on('investConfirmation', function(inv_id) {
            iname = investments[inv_id].name;
            msg = "Investing in " + iname;
            handleNewMessage(msg)
        })

        socket.on('investCompletedConfirmation', function(inv_id) {
            iname = investments[inv_id].name;
            msg = "Done investing in " + iname;
            handleNewMessage(msg)
        })
    
        function makeInvestment(inv_id){
            socket.emit('invest', inv_id);
            console.log('Investment' + inv_id + 'is clicked');

        };
    
        function handleNewMessage(msg){
            $('#messages').append($('<li>').text(msg));
            window.scrollTo(0, document.body.scrollHeight);
        }
        $('form').submit(function () {
            return false;
        });
    </script>

    <!-- Game Screen -->
    <div id='mainscreenbg'>

        <div class="padspace">
            <button type="button" class="btn btn-outline-danger btn-sm" style="margin-right: 10px;"
                onclick=quitGameScreen()>Quit Game (tmp)</button>

            <div class="card-group m-2">
                <div class="card">
                    <!-- Game Screen window-->
                    <h5 class="card-header">Game screen</h5>
                    <div class="card-body d-flex flex-column" style="height:40vh;">
                        <pre id='screen_text' style="font-size: large;"></pre>
                        <ul id="messages">
                            
                        </ul>
                    </div>

                    <!-- Investment window -->
                    <div class="card-footer text-muted">
                        <h5 class="card-title">Investment</h5>
                        <div class="card-body">
                            <!-- Investment List -->
                            <div ng-app="gameInvestment" ng-controller="gameInvestmentCtrl">
                                <button id={{investItem.id}} onclick=triggerInvestmentModal(this.id)
                                    ng-repeat="investItem in investmentList" class="btn btn-primary"
                                    style="border-radius: 25px;">{{investItem.name}}</button>

                                
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sustainable Index window-->
                <div class="card text-center col-sm-4">
                    <div class="card-header">
                        Sustainable Index
                    </div>
                    <!-- Game Status -->
                    <div class="card-body">
                        <!-- Economy Index -->
                        <div class="row align-items-center">
                            <h4 class="col-2">ðŸ’°</h4>
                            <div class="col-10">
                                <div class="progress">
                                    <div class="progress-bar bg-warning" role="progressbar" style="width: 75%"
                                        aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" id="p1_econSI">75
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Environment Index -->
                        <div class="row align-items-center">
                            <h4 class="col-2">ðŸŒ³</h4>
                            <div class="col-10">
                                <div class="progress">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: 70%"
                                        aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" id="p1_envSI">70
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Society Index -->
                        <div class="row align-items-center">
                            <h4 class="col-2">ðŸ‘ª</h4>
                            <div class="col-10">
                                <div class="progress">
                                    <div class="progress-bar bg-danger" role="progressbar" style="width: 70%"
                                        aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" id="p1_socSI">
                                        70</div>
                                </div>
                            </div>
                        </div>
                        <!-- Money -->
                        <br>
                        <div class="row">
                            <h5 class="col-2">ðŸ’´</h5>
                            <div class="col-10">
                                <h5><span id="p1_moneyI">3000</span> credit</h5>
                            </div>
                        </div>

                        <!-- Countdown Timer -->
                        <div>
                            <h5 id="timer"><span id="timer_minutes"></span>:<span id="timer_seconds"></span></h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>



    </div>

    <!-- Title -->
    <div class="vhcenter">
        <img src="../assets/title.png" alt="title" width="400">
        <p class='blink' id='start_des'>click on anywhere to start</p>
    </div>

    <!-- Room Modal -->
    <div class="modal fade text-center" id="RoomModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    
                    <!-- body -->                    
                        <button type="button" class="btn btn-outline-dark" onClick=createRoom()>Create room</button>
                        <button type="button" class="btn  btn-outline-dark" onClick=showJoinButton()>Join Room</button>
                        <br>
                        <br>
                        
                        <div id="showCreateCodeContent" class='hidden'>
                            <h4><span id="room_code_display"></span></h4>
                        </div>
                        <div id="showJoinCodeContent" class='hidden'>
                            <label for="fname">Room code:</label>
                            <input type="text" id="room">
                            <button type="button" class="btn btn-info" onclick=joinRoom()>Join Room</button>
                        </div>

                    <br>
                    <div id="myContent" class='hidden'>
                        <button type="button" class="btn btn-danger" onclick=ready()>Ready Join</button>
                        <button type="button" class="btn btn-danger" onclick=notReady()>Cancel Join</button>
                        <br>
                        <br>
                        <button type="button" class="btn btn-success" onclick=launchGameScreen()
                            data-dismiss="modal">Play</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- How-to-Play Modal -->
    <div class="modal fade" id="htpModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <button>OK</button>
                </div>
            </div>
        </div>
    </div>

    <div class="rbottom">
        <!-- This is a tmp button to trigger game screen, need to be replaced after join room/create room function is done -->
        <button onclick=launchGameScreen()>trigger game screen (tmp)</button>
        <!-- Question Mark (How-to-Play) -->
        <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor"
            class="bi bi-question-circle-fill" viewBox="0 0 16 16">
            <path id="qmark"
                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.496 6.033h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286a.237.237 0 0 0 .241.247zm2.325 6.443c.61 0 1.029-.394 1.029-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94 0 .533.425.927 1.01.927z" />
        </svg>
    </div>

</body>

<!-- Investment Details Modal -->
<div class="modal fade" id="InvestmentModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="inv_title"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p id='inv_des'></p>
                <p id='inv_id'></p>
                <ul>
                    <li>Cost: </li>
                    <ul>
                        <li>Time: <span id='cost_time'></span></li>
                        <li>Money: <span id='cost_money'></span></li>
                    </ul>

                    <li>Changes in Sustainable Index:</li>
                    <ul>
                        <li>Economy +<span id='reward_econ'></span></li>
                        <li>Environment +<span id='reward_env'></span></li>
                        <li>Society +<span id='reward_society'></span></li>
                    </ul>
                    <li>Rewards:</li>
                    <ul>
                        <li>Money +<span id='reward_money'></span></li>
                    </ul>
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" id='invest_button' data-dismiss="modal">Invest!</button>
            </div>
        </div>
    </div>
</div>

<script src="../js/spage.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
</script>

</html>
